# é‡æ–°è®¾è®¡çš„è·¯å¾„è§„åˆ’è¯´æ˜

## ğŸ¯ é—®é¢˜èƒŒæ™¯

ä½ æåˆ°çš„é—®é¢˜å¾ˆé‡è¦ï¼šå‰ç«¯çš„ `/api` è·¯å¾„å¹¶ä¸éƒ½æ˜¯ç¬¬ä¸‰æ–¹APIè°ƒç”¨ï¼Œå¾ˆå¤šæ˜¯å¹³å°è‡ªèº«çš„ä¸šåŠ¡æ¥å£ã€‚

ä¾‹å¦‚ï¼š`http://localhost:8000/api/interfaceInfo/list/page?current=1&pageSize=5` è¿™æ˜¯å¹³å°çš„åˆ†é¡µæŸ¥è¯¢æ¥å£ï¼Œä¸åº”è¯¥èµ°ç¬¬ä¸‰æ–¹APIçš„è®¤è¯æµç¨‹ã€‚

## ğŸ”§ é‡æ–°è®¾è®¡çš„è·¯å¾„è§„åˆ’

### 1. è·¯å¾„åˆ†ç±»

#### ğŸŸ¢ ç™½åå•è·¯å¾„ï¼ˆå®Œå…¨è·³è¿‡è®¤è¯ï¼‰
```
/user/register      - ç”¨æˆ·æ³¨å†Œ
/user/login         - ç”¨æˆ·ç™»å½•  
/user/login/wx_open - å¾®ä¿¡ç™»å½•
/user/logout        - ç”¨æˆ·ç™»å‡º
```

#### ğŸ”µ å¹³å°ä¸šåŠ¡æ¥å£ï¼ˆéœ€è¦ç™»å½•ï¼ŒåŸºäºSessionè®¤è¯ï¼‰
```
/api/user/**           - å¹³å°ç”¨æˆ·ç®¡ç†æ¥å£
/api/interfaceInfo/**  - å¹³å°æ¥å£ä¿¡æ¯ç®¡ç†æ¥å£
/api/analysis/**       - å¹³å°æ•°æ®åˆ†ææ¥å£
```

#### ğŸŸ¡ å¹³å°å†…éƒ¨è°ƒè¯•æ¥å£ï¼ˆéœ€è¦ç™»å½•ï¼ŒåŸºäºSessionè®¤è¯ï¼‰  
```
/interfaceInfo/invoke  - æ¥å£è°ƒç”¨è°ƒè¯•
```

#### ğŸ”´ ç¬¬ä¸‰æ–¹APIè°ƒç”¨ï¼ˆéœ€è¦å¯†é’¥ç­¾åè®¤è¯ï¼‰
```
/third-party/**        - ç¬¬ä¸‰æ–¹APIè°ƒç”¨è·¯å¾„
```

#### ğŸŸ£ å…¶ä»–è·¯å¾„ï¼ˆç›´æ¥æ”¾è¡Œï¼‰
```
/user/**              - ç”¨æˆ·ç›¸å…³ç›´æ¥æ¥å£
/interfaceInfo/**     - æ¥å£ä¿¡æ¯ç›´æ¥æ¥å£ï¼ˆé™¤invokeå¤–ï¼‰
/analysis/**          - åˆ†æç›¸å…³ç›´æ¥æ¥å£
```

### 2. ç½‘å…³è·¯ç”±é…ç½®

```yaml
spring:
  cloud:
    gateway:
      routes:
        # å¹³å°ä¸šåŠ¡æ¥å£è·¯ç”± - éœ€è¦ç™»å½•è®¤è¯
        - id: platform_api_route
          uri: http://localhost:7529
          predicates:
            - Path=/api/**
            
        # ç”¨æˆ·ç›¸å…³æ¥å£
        - id: user_route
          uri: http://localhost:7529
          predicates:
            - Path=/user/**
            
        # æ¥å£ä¿¡æ¯ç®¡ç† - åŒ…æ‹¬invokeè°ƒè¯•
        - id: interface_route
          uri: http://localhost:7529
          predicates:
            - Path=/interfaceInfo/**
            
        # æ•°æ®åˆ†ææ¥å£
        - id: analysis_route
          uri: http://localhost:7529
          predicates:
            - Path=/analysis/**
            
        # ç¬¬ä¸‰æ–¹APIè°ƒç”¨è·¯ç”± - éœ€è¦å¯†é’¥è®¤è¯
        - id: third_party_api_route
          uri: http://localhost:8101
          predicates:
            - Path=/third-party/**
```

### 3. è®¤è¯æµç¨‹

#### ğŸ”µ å¹³å°ä¸šåŠ¡æ¥å£è®¤è¯æµç¨‹
```mermaid
graph TD
    A[å‰ç«¯è¯·æ±‚ /api/interfaceInfo/list/page] --> B[ç½‘å…³æ£€æŸ¥è·¯å¾„]
    B --> C[è¯†åˆ«ä¸ºå¹³å°ä¸šåŠ¡æ¥å£]
    C --> D[æ£€æŸ¥Cookieä¸­çš„Session]
    D --> E{Sessionæ˜¯å¦å­˜åœ¨?}
    E -->|å­˜åœ¨| F[æ”¾è¡Œåˆ°åç«¯æœåŠ¡ 7529]
    E -->|ä¸å­˜åœ¨| G[è¿”å›403ç¦æ­¢è®¿é—®]
    F --> H[åç«¯é€šè¿‡SessionéªŒè¯ç”¨æˆ·èº«ä»½]
    H --> I[è¿”å›æ•°æ®]
```

#### ğŸŸ¡ å¹³å°å†…éƒ¨è°ƒè¯•è®¤è¯æµç¨‹
```mermaid
graph TD
    A[å‰ç«¯è¯·æ±‚ /interfaceInfo/invoke] --> B[ç½‘å…³æ£€æŸ¥è·¯å¾„]
    B --> C[è¯†åˆ«ä¸ºå†…éƒ¨è°ƒè¯•æ¥å£]
    C --> D[æ£€æŸ¥Cookieä¸­çš„Session]
    D --> E{Sessionæ˜¯å¦å­˜åœ¨?}
    E -->|å­˜åœ¨| F[æ”¾è¡Œåˆ°åç«¯æœåŠ¡ 7529]
    E -->|ä¸å­˜åœ¨| G[è¿”å›403ç¦æ­¢è®¿é—®]
    F --> H[åç«¯è·å–ç™»å½•ç”¨æˆ·çš„å¯†é’¥]
    H --> I[è°ƒç”¨ç¬¬ä¸‰æ–¹API]
    I --> J[è¿”å›ç»“æœ]
```

#### ğŸ”´ ç¬¬ä¸‰æ–¹APIè°ƒç”¨è®¤è¯æµç¨‹
```mermaid
graph TD
    A[ç¬¬ä¸‰æ–¹å¼€å‘è€…è¯·æ±‚ /third-party/api/name] --> B[ç½‘å…³æ£€æŸ¥è·¯å¾„]
    B --> C[è¯†åˆ«ä¸ºç¬¬ä¸‰æ–¹APIè°ƒç”¨]
    C --> D[éªŒè¯è¯·æ±‚å¤´ä¸­çš„accessKey]
    D --> E[éªŒè¯ç­¾å]
    E --> F[æ£€æŸ¥è°ƒç”¨æ¬¡æ•°]
    F --> G[æ”¾è¡Œåˆ°æ¥å£æœåŠ¡ 8101]
    G --> H[è¿”å›ç»“æœ]
```

## ğŸ“‹ è¯·æ±‚ç¤ºä¾‹å¯¹æ¯”

### 1. å¹³å°ä¸šåŠ¡æ¥å£è¯·æ±‚
```bash
# å‰ç«¯åˆ†é¡µæŸ¥è¯¢æ¥å£
curl -X GET "http://localhost:8090/api/interfaceInfo/list/page?current=1&pageSize=5" \
  -H "Cookie: SESSION=your-session-id"
```

**ç‰¹ç‚¹**ï¼š
- âœ… åªéœ€è¦Sessionè®¤è¯
- âœ… ç”¨äºå¹³å°ä¸šåŠ¡åŠŸèƒ½
- âœ… å‰ç«¯ç”¨æˆ·æ—¥å¸¸æ“ä½œ

### 2. å¹³å°å†…éƒ¨è°ƒè¯•è¯·æ±‚
```bash
# å‰ç«¯è°ƒè¯•æ¥å£
curl -X POST http://localhost:8090/interfaceInfo/invoke \
  -H "Content-Type: application/json" \
  -H "Cookie: SESSION=your-session-id" \
  -d '{"id":1,"userRequestParams":"{\"name\":\"test\"}"}'
```

**ç‰¹ç‚¹**ï¼š
- âœ… Sessionè®¤è¯ï¼Œè‡ªåŠ¨ä½¿ç”¨ç”¨æˆ·å¯†é’¥
- âœ… ç”¨äºæ¥å£è°ƒè¯•
- âœ… ç”¨æˆ·ä½“éªŒå‹å¥½

### 3. ç¬¬ä¸‰æ–¹APIè°ƒç”¨è¯·æ±‚
```bash
# ç¬¬ä¸‰æ–¹å¼€å‘è€…è°ƒç”¨ï¼ˆæ–°è·¯å¾„ï¼‰
curl -X GET http://localhost:8090/third-party/api/name \
  -H "accessKey: qiapi_1703123456789_abc12def" \
  -H "nonce: 12345" \
  -H "timestamp: 1703123456" \
  -H "sign: calculated-signature" \
  -H "body: {}"
```

**ç‰¹ç‚¹**ï¼š
- âœ… å®Œæ•´çš„å¯†é’¥è®¤è¯
- âœ… ç”¨äºç¬¬ä¸‰æ–¹é›†æˆ
- âœ… å®‰å…¨æ€§æœ€é«˜

## ğŸ”„ è¿ç§»æ–¹æ¡ˆ

### å¯¹äºç°æœ‰çš„ç¬¬ä¸‰æ–¹å¼€å‘è€…
éœ€è¦å°†APIè°ƒç”¨è·¯å¾„ä» `/api/**` æ”¹ä¸º `/third-party/**`

#### è¿ç§»ç¤ºä¾‹
```bash
# æ—§çš„è°ƒç”¨æ–¹å¼
curl -X GET http://localhost:8090/api/name

# æ–°çš„è°ƒç”¨æ–¹å¼  
curl -X GET http://localhost:8090/third-party/api/name
```

### å¯¹äºå‰ç«¯å¼€å‘
å‰ç«¯çš„å¹³å°ä¸šåŠ¡æ¥å£è·¯å¾„ä¿æŒä¸å˜ï¼Œç»§ç»­ä½¿ç”¨ `/api/**`

#### å‰ç«¯æ¥å£åˆ†ç±»
```javascript
// å¹³å°ä¸šåŠ¡æ¥å£ - Sessionè®¤è¯
const platformApi = {
  getUserList: '/api/user/list/page',
  getInterfaceList: '/api/interfaceInfo/list/page', 
  getAnalysis: '/api/analysis/top/interface/invoke'
};

// æ¥å£è°ƒè¯• - Sessionè®¤è¯
const debugApi = {
  invokeInterface: '/interfaceInfo/invoke'
};

// ç¬¬ä¸‰æ–¹APIè°ƒç”¨ - å¯†é’¥è®¤è¯ï¼ˆå¦‚æœå‰ç«¯éœ€è¦ç›´æ¥è°ƒç”¨ï¼‰
const thirdPartyApi = {
  callExternalApi: '/third-party/api/name'  
};
```

## âœ… å®ç°ä¼˜åŠ¿

1. **è·¯å¾„è¯­ä¹‰æ¸…æ™°**
   - `/api/**` = å¹³å°ä¸šåŠ¡æ¥å£
   - `/interfaceInfo/invoke` = å¹³å°è°ƒè¯•æ¥å£  
   - `/third-party/**` = ç¬¬ä¸‰æ–¹APIè°ƒç”¨

2. **è®¤è¯æœºåˆ¶åˆç†**
   - å¹³å°æ¥å£ä½¿ç”¨Sessionï¼Œç”¨æˆ·ä½“éªŒå¥½
   - ç¬¬ä¸‰æ–¹è°ƒç”¨ä½¿ç”¨å¯†é’¥ï¼Œå®‰å…¨æ€§é«˜
   - ç™½åå•æ¥å£æ— éœ€è®¤è¯ï¼Œæ³¨å†Œç™»å½•é¡ºç•…

3. **å‘åå…¼å®¹**
   - å‰ç«¯ä»£ç åŸºæœ¬ä¸éœ€è¦ä¿®æ”¹
   - åªéœ€è¦ç¬¬ä¸‰æ–¹å¼€å‘è€…æ›´æ–°è°ƒç”¨è·¯å¾„

4. **æ¶æ„æ¸…æ™°**
   - ä¸šåŠ¡é€»è¾‘åˆ†ç¦»æ˜ç¡®
   - è®¤è¯æµç¨‹èŒè´£å•ä¸€
   - ä¾¿äºåç»­æ‰©å±•

ç°åœ¨ä½ çš„ç³»ç»Ÿè·¯å¾„è§„åˆ’æ›´åŠ åˆç†ï¼Œå¹³å°ä¸šåŠ¡æ¥å£å’Œç¬¬ä¸‰æ–¹APIè°ƒç”¨å®Œå…¨åˆ†ç¦»äº†ï¼ğŸ‰